# SleepGuardian — «страж от сна» во время больших загрузок

SleepGuardian не даёт компьютеру уснуть, пока идёт активная загрузка или интенсивная работа диска (например, установка игры после скачивания). Когда активность заканчивается — компьютер может сразу уйти в сон/гибернацию, если по правилам системы уже «пора».

## Возможности

- отслеживает сетевую и дисковую активность;
- поддерживает исключения по процессам, портам и интерфейсам;
- может отображать значок в системном трее для управления;
- умеет переводить систему в `suspend` или `hibernate` по завершении работы.

## Сборка

Требуется [Go](https://golang.org/) не ниже 1.21.

Собрать бинарник для текущей платформы:

```bash
make
```

Или указать набор целевых платформ:

```bash
make TARGETS="windows/amd64 linux/amd64"
```

## Конфигурация

Пример конфигурации находится в [`configs/config.example.json`](configs/config.example.json).
По умолчанию программа ищет `config.json` рядом с исполняемым файлом, путь можно задать флагом `--config`.

Файл представляет собой корректный JSON в кодировке UTF‑8. Верхний уровень включает несколько разделов:

```json
{
  "log": {...},
  "monitor": {...},
  "exceptions": {...},
  "sleep": {...},
  "tray": {"show": true}
}
```

### log
Настройки логирования:
- `level` — `debug`, `info`, `warn` или `error`;
- `format` — `text` или `json`;
- `file` — путь к файлу журнала (пустая строка — вывод в stdout).

### monitor
Параметры отслеживания активности:
- `interval_ms` — период опроса в миллисекундах (по умолчанию 1000);
- `weights.net` и `weights.disk` — коэффициенты важности для сети и диска;
- `active_threshold_bps` и `idle_threshold_bps` — пороги активности в байтах/секунду, должны быть > 0;
- `min_active_sec` и `min_idle_sec` — минимальная длительность состояния;
- `interfaces_include`/`interfaces_exclude` — списки сетевых интерфейсов;
- `disks_include`/`disks_exclude` — списки дисков. Пустые списки означают «все».

### exceptions
Что игнорировать при расчёте активности:
- `process_names` и `process_paths` — исполняемые файлы;
- `ports_exclude` — сетевые порты;
- `ips_exclude` — IP‑адреса;
- `interfaces_exclude` — сетевые интерфейсы.

### sleep
Поведение при переходе в сон:
- `mode` — `system`, `suspend`, `hibernate` или `none`;
- `fallback` — режим, используемый, если основной недоступен;
- `idle_grace_sec` — задержка после простоя перед засыпанием;
- `immediate_on_finish` — усыплять сразу после завершения активной задачи.

### tray
Показывать ли значок в трее:
- `show` — `true`/`false`.

При создании файла следите за правильностью JSON‑синтаксиса: кавычки двойные, элементы в массивах разделяются запятыми, комментарии не допускаются.

## Запуск

```bash
sleepguardian --config /path/to/config.json
```

После старта значок трея (если включён) позволяет приостановить мониторинг или немедленно усыпить систему.
